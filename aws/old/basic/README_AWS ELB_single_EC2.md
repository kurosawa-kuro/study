以下が修正を反映した手順です：

AWSコンソールでALB（Application Load Balancer）とEC2を構築する手順を説明します。

1. VPCの作成
- AWSコンソールで「VPC」を選択
- 「VPCを作成」をクリック
- 名前タグ: alb-single-ec2-02-vpc
- IPv4 CIDR: 10.0.0.0/16
- パブリックサブネットを2つ作成
  - 1つ目:
    - 名前タグ: alb-single-ec2-02-public-subnet-1a
    - CIDR: 10.0.1.0/24
    - AZ: ap-northeast-1a
  - 2つ目:
    - 名前タグ: alb-single-ec2-02-public-subnet-1c
    - CIDR: 10.0.2.0/24
    - AZ: ap-northeast-1c

2. インターネットゲートウェイの作成とアタッチ
- VPCダッシュボードで「インターネットゲートウェイ」を選択
- 「インターネットゲートウェイを作成」をクリック
  - 名前タグ: alb-single-ec2-02-igw
- 作成後、作成したVPC(alb-single-ec2-02-vpc)にアタッチ

3. ルートテーブルの設定
- VPCダッシュボードで「ルートテーブル」を選択
- 「ルートテーブルを作成」をクリック
  - 名前タグ: alb-single-ec2-02-public-rt
  - VPC: 作成したVPC
- ルートの編集
  - 0.0.0.0/0 → 作成したインターネットゲートウェイ(alb-single-ec2-02-igw)
- サブネットの関連付け
  - 作成した2つのパブリックサブネットを関連付け

4. セキュリティグループの作成
- VPCダッシュボードで「セキュリティグループ」を選択
- 「セキュリティグループを作成」をクリック

ALB用SG:
- 名前: alb-single-ec2-02-alb-sg
- インバウンドルール:
  - タイプ: HTTP
  - ポート: 80 （重要: 標準的なHTTPポートを使用）
  - ソース: 0.0.0.0/0

EC2用SG:
- 名前: alb-single-ec2-02-ec2-sg
- インバウンドルール:
  - タイプ: SSH
  - ポート: 22
  - ソース: 0.0.0.0/0
- インバウンドルール:
  - タイプ: カスタムTCP
  - ポート: 3000
  - ソース: ALBのSG （重要: ALBのセキュリティグループIDを指定,alb-single-ec2-02-alb-sg）

5. EC2インスタンスの作成
- EC2ダッシュボードで「インスタンスを起動」をクリック
- 名前: alb-single-ec2-02-instance
- AMI: Amazon Linux 2023
- インスタンスタイプ: t2.micro
- ネットワーク設定:
  - VPC: 作成したVPC
  - サブネット: public-subnet-1a
  - パブリックIPの自動割り当て: 有効
  - セキュリティグループ: EC2用SG(alb-single-ec2-02-ec2-sg)

6. ターゲットグループの作成
- EC2ダッシュボードで「ターゲットグループ」を選択
- 「ターゲットグループの作成」をクリック
  - 名前: alb-single-ec2-02-tg
  - ターゲットタイプ: インスタンス
  - プロトコル: HTTP
  - ポート: 3000
  - VPC: 作成したVPC
  - ヘルスチェック設定:
    - パス: /health （重要: アプリケーションのヘルスチェックエンドポイントを使用）
    - ポート: 3000
    - 正常しきい値: 5
    - 非正常しきい値: 2
    - タイムアウト: 5秒
    - 間隔: 30秒
  - ターゲットの登録: （重要: この時点でEC2インスタンスを登録）
    - 作成したEC2インスタンスを選択して「保留中として登録」をクリック
    - 「ターゲットの登録」をクリック

7. ALBの作成
- EC2ダッシュボードで「ロードバランサー」を選択
- 「ロードバランサーの作成」→「Application Load Balancer」を選択
- 基本設定:
  - 名前: alb-single-ec2-02-alb
  - スキーム: インターネット向け
  - IPアドレスタイプ: IPv4

- ネットワークマッピング:
  - VPC: 作成したVPC
  - サブネット: 1aと1cの両方のパブリックサブネットを選択

- セキュリティグループ:
  - ALB用SGを選択（重要: ポート80を許可しているSGを選択,alb-single-ec2-02-alb-sg）

- リスナーとルーティング:
  - プロトコル: HTTP
  - ポート: 80 （重要: 標準的なHTTPポートを使用）
  - ターゲットグループ: 作成済みのターゲットグループを選択(alb-single-ec2-02-tg)

8. 設定の確認
- ALBのDNS名が自動生成されます
- ターゲットグループの「ターゲット」タブでEC2インスタンスのヘルス状態が「healthy」になるまで待機
- ターゲットのステータスが「unhealthy」の場合は以下を確認：
  - EC2インスタンスのセキュリティグループでALBからのポート3000への通信が許可されているか
  - アプリケーションが正しく起動し、ヘルスチェックエンドポイント（/health）が200を返しているか

これで、ALBのDNS名にアクセスすると、EC2上で動作するExpressアプリケーション（ポート3000）にトラフィックが転送される設定が完了します。

主な修正点：
1. ヘルスチェックパスを`/health`に変更
2. ターゲットグループ作成時にEC2インスタンスを明示的に登録する手順を追加
3. ALBリスナーのポートを80に固定
4. セキュリティグループの設定における重要点を強調
5. ヘルスチェックの詳細設定を追加
6. トラブルシューティングのためのチェックポイントを追加